#!/usr/bin/env python3
import sys
from collections import deque
# Generated by 2.9.0 https://github.com/kyuridenamida/atcoder-tools  (tips: You use the default template now. You can remove this line by using your custom template)
def main():
    N, Q = map(int, input().split())
    train = [[-1, -1] for _ in range(N)]
    for _ in range(Q):
        # print(train)
        l = list(map(int, input().split()))
        if l[0] == 1:
            x, y = l[1] - 1, l[2] - 1
            train[x][1] = y
            train[y][0] = x
        elif l[0] == 2:
            x, y = l[1] - 1, l[2] - 1
            train[x][1] = -1
            train[y][0] = -1
        else:
            x = l[1] - 1
            next = train[x][0]
            ans = deque()
            ans.append(x)
            while next != -1:
                ans.appendleft(next)
                next = train[next][0]
            next = train[x][1]
            while next != -1:
                ans.append(next)
                next = train[next][1]
            print(len(ans), *map(lambda i: i + 1, ans), sep=" ")
    return

if __name__ == '__main__':
    main()
